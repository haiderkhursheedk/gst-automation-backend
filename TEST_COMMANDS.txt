$response = Invoke-RestMethod -Uri "https://gst-automation-backend.vercel.app/info" -Method Post -ContentType "application/json" -Body '{"gstin": "27BEVPK8479R1ZX"}'

if ($response.status -eq "captcha_required") {
    $base64 = $response.captcha_image -replace '^data:image/png;base64,', ''
    $bytes = [Convert]::FromBase64String($base64)
    [IO.File]::WriteAllBytes("captcha_received.png", $bytes)
    Write-Host "Captcha saved to captcha_received.png"
} else {
    Write-Host "No Captcha required"
    $response
}

# 2. Submit Verification (if captcha required)
curl.exe -X POST https://gst-automation-backend.vercel.app/verify -H "Content-Type: application/json" -d '{"gstin": "27BEVPK8479R1ZX", "captcha_solution": "code"}'
